2014-05-27 22:31:59,206 [2176] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 22:31:59,313 [2176] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 22:31:59,324 [2176] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 22:31:59,336 [2176] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 22:33:18,729 [4408] DEBUG Servicesys_user - 获取实体对象
2014-05-27 22:33:18,774 [4408] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  'hedanian'and IsEnable =  'True'
2014-05-27 22:33:48,284 [6212] DEBUG Servicesys_user - 获取实体对象
2014-05-27 22:33:48,284 [6212] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  '1234'and IsEnable =  'True'
2014-05-27 22:33:48,597 [6212] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'admin' 
2014-05-27 22:33:48,994 [6212] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('admin','管理员','henley-PC','localhost','','2014/5/27 22:33:48')
2014-05-27 22:33:49,063 [6212] DEBUG Servicemms_project - 获取实体对象
2014-05-27 22:33:49,064 [6212] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2014-05-27 22:33:49,143 [3092] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2014-05-27 22:34:02,143 [6212] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2014-05-27 22:43:14,917 [6536] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/lossreport/Index','/Mms/lossreport')
2014-05-27 22:43:14,950 [6536] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 22:43:14,962 [6536] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 22:43:19,892 [3620] DEBUG Servicemms_lossReport - 获取动态列表
2014-05-27 22:43:19,892 [3620] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName
     from 
        mms_LossReport A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 22:43:19,976 [3620] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName
     from 
        mms_LossReport A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 22:43:23,181 [4544] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/lossreport/edit')
2014-05-27 22:43:23,203 [4544] DEBUG Servicemms_lossReport - 获取实体对象
2014-05-27 22:43:23,203 [4544] DEBUG Mms - select mms_lossReport.* from mms_lossReport where  BillNo =  '201307230003'
2014-05-27 22:43:23,349 [4544] DEBUG Servicemms_lossReport - 获取上一条下一条数据
2014-05-27 22:43:23,400 [4544] DEBUG Servicemms_lossReport - 获取字段
2014-05-27 22:43:23,403 [4544] DEBUG Mms - select top 1 BillNo from mms_lossReport where  ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:43:23,411 [4544] DEBUG Servicemms_lossReport - 获取字段
2014-05-27 22:43:23,411 [4544] DEBUG Mms - select top 1 BillNo from mms_lossReport where  BillNo < '201307230003'and ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:43:23,420 [4544] DEBUG Servicemms_lossReport - 获取字段
2014-05-27 22:43:23,421 [4544] DEBUG Mms - select top 1 BillNo from mms_lossReport where  BillNo >  '201307230003'and ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:43:23,428 [4544] DEBUG Servicemms_lossReport - 获取字段
2014-05-27 22:43:23,428 [4544] DEBUG Mms - select top 1 BillNo from mms_lossReport where  ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:43:23,503 [4544] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:43:23,504 [4544] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2014-05-27 22:43:23,510 [4544] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 22:43:23,512 [4544] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 22:43:27,551 [3620] DEBUG Servicemms_lossReportDetail - 获取动态列表
2014-05-27 22:43:27,552 [3620] DEBUG Mms - select 
        A.*, C.MaterialName,C.Model,C.Material,D.Num as StockNum,D.UnitPrice as StockUnitPrice
     from 
        mms_LossReportDetail A
        left join mms_LossReport B on B.BillNo = A.BillNo
        left join mms_material C on C.MaterialCode = A.MaterialCode
        left join mms_warehouseStock D on D.WarehouseCode = B.WarehouseCode and D.MaterialCode = A.MaterialCode
     where  A.BillNo =  '201307230003' order by A.RowId
2014-05-27 22:43:37,717 [3620] DEBUG Servicemms_lossReport - 获取新主键
2014-05-27 22:43:37,720 [3620] DEBUG Mms - select isnull(max(BillNo),0) from mms_lossReport
2014-05-27 22:43:38,120 [6348] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/lossreport/edit')
2014-05-27 22:43:38,127 [6348] DEBUG Servicemms_lossReport - 获取实体对象
2014-05-27 22:43:38,127 [6348] DEBUG Mms - select mms_lossReport.* from mms_lossReport where  BillNo =  '201405270001'
2014-05-27 22:43:38,130 [6348] DEBUG Servicemms_lossReport - 获取上一条下一条数据
2014-05-27 22:43:38,130 [6348] DEBUG Servicemms_lossReport - 获取字段
2014-05-27 22:43:38,131 [6348] DEBUG Mms - select top 1 BillNo from mms_lossReport where  ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:43:38,136 [6348] DEBUG Servicemms_lossReport - 获取字段
2014-05-27 22:43:38,136 [6348] DEBUG Mms - select top 1 BillNo from mms_lossReport where  BillNo < '201405270001'and ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:43:38,139 [6348] DEBUG Servicemms_lossReport - 获取字段
2014-05-27 22:43:38,140 [6348] DEBUG Mms - select top 1 BillNo from mms_lossReport where  BillNo >  '201405270001'and ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:43:38,145 [6348] DEBUG Servicemms_lossReport - 获取字段
2014-05-27 22:43:38,145 [6348] DEBUG Mms - select top 1 BillNo from mms_lossReport where  ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:43:38,148 [6348] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:43:38,148 [6348] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2014-05-27 22:43:38,150 [6348] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 22:43:38,150 [6348] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 22:43:41,485 [3620] DEBUG Servicemms_lossReportDetail - 获取动态列表
2014-05-27 22:43:41,486 [3620] DEBUG Mms - select 
        A.*, C.MaterialName,C.Model,C.Material,D.Num as StockNum,D.UnitPrice as StockUnitPrice
     from 
        mms_LossReportDetail A
        left join mms_LossReport B on B.BillNo = A.BillNo
        left join mms_material C on C.MaterialCode = A.MaterialCode
        left join mms_warehouseStock D on D.WarehouseCode = B.WarehouseCode and D.MaterialCode = A.MaterialCode
     where  A.BillNo =  '201405270001' order by A.RowId
2014-05-27 22:44:02,648 [4544] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/menu/Index','/Sys/menu')
2014-05-27 22:44:04,863 [5440] DEBUG Servicesys_menu - 获取动态列表
2014-05-27 22:44:04,864 [5440] DEBUG Sys - select A.*,B.MenuName as ParentName from sys_menu A left join sys_menu B on B.MenuCode = A.ParentCode order by A.MenuSeq,A.MenuCode
2014-05-27 22:46:27,450 [2592] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 22:46:27,482 [2592] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 22:46:27,490 [2592] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 22:46:27,490 [2592] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 22:46:27,954 [5260] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2014-05-27 22:46:34,243 [6780] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2014-05-27 22:48:21,026 [2424] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2014-05-27 22:48:23,691 [6864] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2014-05-27 22:48:31,227 [2424] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/Index','/Mms/receive')
2014-05-27 22:48:31,368 [2424] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 22:48:31,395 [2424] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 22:48:31,400 [2424] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:48:31,401 [2424] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2014-05-27 22:48:34,154 [312] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 22:48:34,155 [312] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 22:48:34,188 [312] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 22:48:36,805 [2424] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/edit')
2014-05-27 22:48:36,842 [2424] DEBUG Servicemms_receive - 获取实体对象
2014-05-27 22:48:36,848 [2424] DEBUG Mms - select mms_receive.* from mms_receive where  BillNo =  '201307020016'
2014-05-27 22:48:36,869 [2424] DEBUG Servicemms_receive - 获取上一条下一条数据
2014-05-27 22:48:36,904 [2424] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:48:36,906 [2424] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:48:36,914 [2424] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:48:36,914 [2424] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo < '201307020016'and ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:48:36,920 [2424] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:48:36,921 [2424] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo >  '201307020016'and ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:48:36,926 [2424] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:48:36,927 [2424] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:48:36,999 [2424] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:48:37,000 [2424] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2014-05-27 22:48:37,006 [2424] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:48:37,007 [2424] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2014-05-27 22:48:37,009 [2424] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:48:37,009 [2424] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'PayType'
2014-05-27 22:48:37,015 [2424] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 22:48:37,015 [2424] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 22:48:37,019 [2424] DEBUG Servicesys_code - 获取字段
2014-05-27 22:48:37,020 [2424] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'SupplyType'and IsEnable =  'True'and IsDefault =  'True'
2014-05-27 22:48:37,025 [2424] DEBUG Servicesys_code - 获取字段
2014-05-27 22:48:37,025 [2424] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'PayType'and IsEnable =  'True'and IsDefault =  'True'
2014-05-27 22:48:40,240 [5260] DEBUG ServiceModelBase - 获取动态列表
2014-05-27 22:48:40,241 [5260] DEBUG Mms - select 
    MerchantsCode   as   value,MerchantsName   as   text
   from 
    mms_merchants A
    left join mms_merchantsType B on B.MerchantsTypeCode = A.MerchantsTypeCode
   where  MerchantsCode in ('CG00303') order by MerchantsCode
2014-05-27 22:48:40,618 [6864] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 22:48:40,619 [6864] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_receiveDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '201307020016' order by A.MaterialCode
2014-05-27 22:49:38,879 [6864] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/edit')
2014-05-27 22:49:38,889 [6864] DEBUG Servicemms_receive - 获取实体对象
2014-05-27 22:49:38,890 [6864] DEBUG Mms - select mms_receive.* from mms_receive where  BillNo =  '201307020016'
2014-05-27 22:49:38,892 [6864] DEBUG Servicemms_receive - 获取上一条下一条数据
2014-05-27 22:49:38,892 [6864] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:49:38,892 [6864] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:49:38,893 [6864] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:49:38,893 [6864] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo < '201307020016'and ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:49:38,894 [6864] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:49:38,894 [6864] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo >  '201307020016'and ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:49:38,894 [6864] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:49:38,895 [6864] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:49:38,895 [6864] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:49:38,897 [6864] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2014-05-27 22:49:38,898 [6864] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:49:38,898 [6864] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2014-05-27 22:49:38,902 [6864] DEBUG Servicesys_code - 获取动态列表
2014-05-27 22:49:38,902 [6864] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'PayType'
2014-05-27 22:49:38,904 [6864] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 22:49:38,905 [6864] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 22:49:38,907 [6864] DEBUG Servicesys_code - 获取字段
2014-05-27 22:49:38,908 [6864] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'SupplyType'and IsEnable =  'True'and IsDefault =  'True'
2014-05-27 22:49:38,908 [6864] DEBUG Servicesys_code - 获取字段
2014-05-27 22:49:38,909 [6864] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'PayType'and IsEnable =  'True'and IsDefault =  'True'
2014-05-27 22:49:43,679 [6864] DEBUG ServiceModelBase - 获取动态列表
2014-05-27 22:49:43,679 [6864] DEBUG Mms - select 
    MerchantsCode   as   value,MerchantsName   as   text
   from 
    mms_merchants A
    left join mms_merchantsType B on B.MerchantsTypeCode = A.MerchantsTypeCode
   where  MerchantsCode in ('CG00303') order by MerchantsCode
2014-05-27 22:49:44,967 [6404] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 22:49:44,967 [6404] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_receiveDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '201307020016' order by A.MaterialCode
2014-05-27 22:53:41,843 [2032] DEBUG Servicemms_receive - 获取实体对象
2014-05-27 22:53:41,843 [2032] DEBUG Mms - select mms_receive.* from mms_receive where  BillNo =  '201307020022'
2014-05-27 22:53:41,849 [2032] DEBUG Servicemms_receive - 获取上一条下一条数据
2014-05-27 22:53:41,850 [2032] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:53:41,850 [2032] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:53:41,851 [2032] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:53:41,851 [2032] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo < '201307020022'and ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:53:41,856 [2032] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:53:41,857 [2032] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo >  '201307020022'and ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:53:41,860 [2032] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:53:41,860 [2032] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:53:41,961 [2200] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 22:53:41,962 [2200] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_receiveDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '201307020022' order by A.MaterialCode
2014-05-27 22:53:42,871 [2032] DEBUG ServiceModelBase - 获取动态列表
2014-05-27 22:53:42,871 [2032] DEBUG Mms - select 
    MerchantsCode   as   value,MerchantsName   as   text
   from 
    mms_merchants A
    left join mms_merchantsType B on B.MerchantsTypeCode = A.MerchantsTypeCode
   where  MerchantsCode in ('CG00304') order by MerchantsCode
2014-05-27 22:53:46,649 [5260] DEBUG Servicemms_receive - 获取实体对象
2014-05-27 22:53:46,650 [5260] DEBUG Mms - select mms_receive.* from mms_receive where  BillNo =  '201307020024'
2014-05-27 22:53:46,655 [5260] DEBUG Servicemms_receive - 获取上一条下一条数据
2014-05-27 22:53:46,655 [5260] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:53:46,656 [5260] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:53:46,658 [5260] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:53:46,658 [5260] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo < '201307020024'and ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:53:46,662 [5260] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:53:46,662 [5260] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo >  '201307020024'and ProjectCode =  '201306030001' order by BillNo
2014-05-27 22:53:46,670 [5260] DEBUG Servicemms_receive - 获取字段
2014-05-27 22:53:46,670 [5260] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 22:53:46,811 [2032] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 22:53:46,811 [2032] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_receiveDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '201307020024' order by A.MaterialCode
2014-05-27 22:53:48,112 [2200] DEBUG ServiceModelBase - 获取动态列表
2014-05-27 22:53:48,112 [2200] DEBUG Mms - select 
    MerchantsCode   as   value,MerchantsName   as   text
   from 
    mms_merchants A
    left join mms_merchantsType B on B.MerchantsTypeCode = A.MerchantsTypeCode
   where  MerchantsCode in ('CG00301') order by MerchantsCode
2014-05-27 22:54:02,739 [5260] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/rentin/Index','/Mms/rentin')
2014-05-27 22:54:02,763 [5260] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 22:54:02,763 [5260] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 22:54:06,809 [2424] DEBUG Servicemms_rentIn - 获取动态列表
2014-05-27 22:54:06,810 [2424] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MerchantsName
     from 
        mms_rentIn A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_merchants     C on C.MerchantsCode    = A.SupplierCode
     order by A.BillNo
2014-05-27 22:54:06,843 [2424] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MerchantsName
     from 
        mms_rentIn A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_merchants     C on C.MerchantsCode    = A.SupplierCode
     ) tb_temp
2014-05-27 22:56:09,746 [2200] DEBUG Servicemms_rentIn - 获取动态列表
2014-05-27 22:56:09,746 [2200] DEBUG Mms - select 
        A.*, B.ProjectName, C.MerchantsName
     from 
        mms_rentIn A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_merchants     C on C.MerchantsCode    = A.SupplierCode
     order by A.BillNo
2014-05-27 22:56:28,883 [2200] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/menu/Index','/Sys/menu')
2014-05-27 22:56:30,998 [2200] DEBUG Servicesys_menu - 获取动态列表
2014-05-27 22:56:30,999 [2200] DEBUG Sys - select A.*,B.MenuName as ParentName from sys_menu A left join sys_menu B on B.MenuCode = A.ParentCode order by A.MenuSeq,A.MenuCode
2014-05-27 22:56:33,262 [2424] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/organize/Index','/Sys/organize')
2014-05-27 22:56:33,284 [2424] DEBUG Servicesys_organize - 获取实体列表
2014-05-27 22:56:33,286 [2424] DEBUG Sys - select sys_organize.* from sys_organize
2014-05-27 22:56:36,931 [2200] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/permission/Index','/Sys/permission')
2014-05-27 22:56:39,816 [2424] DEBUG Servicesys_permission - 获取动态列表
2014-05-27 22:56:39,816 [2424] DEBUG Sys - select A.*,B.PermissionName as ParentName from sys_permission A left join sys_permission B on B.PermissionCode = A.ParentCode
2014-05-27 22:56:43,905 [5416] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/user/Index','/Sys/user')
2014-05-27 22:56:46,645 [2424] DEBUG Servicesys_organize - 获取实体列表
2014-05-27 22:56:46,646 [2424] DEBUG Sys - select sys_organize.* from sys_organize
2014-05-27 22:56:46,752 [5260] DEBUG Servicesys_user - 获取实体列表
2014-05-27 22:56:46,754 [5260] DEBUG Sys - select top 20 sys_user.* from sys_user order by UserSeq
2014-05-27 22:56:46,883 [5260] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user ) tb_temp
2014-05-27 22:56:51,851 [5260] DEBUG Sys - 
select distinct A.RoleCode,A.RoleName
,(case when B.RoleCode is null then 'false' else 'true' end) as Checked
from sys_role A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode and B.UserCode = 'scy'
2014-05-27 22:57:14,037 [5260] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/merchant/Index','/Mms/merchant')
2014-05-27 22:57:16,690 [2200] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 22:57:16,691 [2200] DEBUG Mms - select top 20 mms_merchants.* from mms_merchants order by MerchantsCode
2014-05-27 22:57:16,733 [2200] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants ) tb_temp
2014-05-27 22:57:16,738 [2424] DEBUG Servicemms_merchantsType - 获取动态列表
2014-05-27 22:57:16,739 [2424] DEBUG Mms - select mms_merchantsType.* from mms_merchantsType order by MerchantsTypeCode
2014-05-27 22:57:27,885 [5260] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 22:57:27,886 [5260] DEBUG Mms - select top 20 mms_merchants.* from mms_merchants order by MerchantsCode
2014-05-27 22:57:27,891 [5260] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants ) tb_temp
2014-05-27 23:00:42,677 [5408] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 23:00:42,678 [5408] DEBUG Mms - select top 20 mms_merchants.* from mms_merchants where  MerchantsTypeCode =  '001' order by MerchantsCode
2014-05-27 23:00:42,688 [5408] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants where  MerchantsTypeCode =  '001' ) tb_temp
2014-05-27 23:00:47,282 [3880] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 23:00:47,282 [3880] DEBUG Mms - select top 20 mms_merchants.* from mms_merchants where  MerchantsTypeCode =  '004' order by MerchantsCode
2014-05-27 23:00:47,307 [3880] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants where  MerchantsTypeCode =  '004' ) tb_temp
2014-05-27 23:01:43,057 [5416] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/receivesummary')
2014-05-27 23:01:46,104 [3880] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/warehousequery')
2014-05-27 23:01:46,118 [3880] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:01:46,119 [3880] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:01:47,828 [7660] DEBUG Mms - 
Select mms_warehouseStock.*,mms_material.MaterialName,mms_material.Model,mms_warehouse.WarehouseName,
    mms_warehouseStock.WarehouseCode+'_'+mms_material.MaterialCode as id,'' AS name
From mms_warehouseStock
Left join mms_warehouse on mms_warehouseStock.WarehouseCode=mms_warehouse.WarehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStock.MaterialCode
Where mms_warehouse.ProjectCode='201306030001' 

                
2014-05-27 23:01:48,341 [5260] DEBUG Mms - 
Select T.*
From
( 
    --收料单
    Select mms_receive.BillNo As SrcBillNo,'receive' As SrcBillType,mms_receive.ContractCode As ContractCode,
	    mms_receive.SupplierCode,mms_receive.OriginalNum,mms_receive.ReceiveDate As TakeDate,
	    mms_receiveDetail.MaterialCode,mms_receiveDetail.Unit,mms_receiveDetail.UnitPrice,
	    mms_receiveDetail.Num,mms_receiveDetail.Money,mms_receiveDetail.Remark,mms_merchants.MerchantsName AS SupplierName,
        '' as name,(mms_receive.BillNo+'receive'+mms_receiveDetail.MaterialCode) as id,mms_material.MaterialName,mms_material.Model
    From mms_receiveDetail
    Left join mms_receive ON mms_receiveDetail.BillNo=mms_receive.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_receive.SupplierCode
    left join mms_material on mms_material.MaterialCode=mms_receiveDetail.MaterialCode
    Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

    UNION

    --直入直出
    Select mms_direct.BillNo As SrcBillNo,'direct' As SrcBillType,mms_direct.ContractCode As ContractCode,
	    mms_direct.SupplierCode,mms_direct.OriginalNum,mms_direct.ArriveDate As TakeDate,
	    mms_directDetail.MaterialCode,mms_directDetail.Unit,mms_directDetail.UnitPrice,
	    mms_directDetail.Num,mms_directDetail.Money,mms_directDetail.Remark,mms_merchants.MerchantsName AS SupplierName,
        '' as name,(mms_direct.BillNo+'direct'+mms_directDetail.MaterialCode) as id,mms_material.MaterialName,mms_material.Model
    From mms_directDetail
    Left join mms_direct ON mms_directDetail.BillNo=mms_direct.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_direct.SupplierCode
    left join mms_material on mms_material.MaterialCode=mms_directDetail.MaterialCode
    Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

    UNION

    --退货
    Select mms_return.BillNo As SrcBillNo,'return' As SrcBillType,mms_return.ContractCode As ContractCode,
	    mms_return.SupplierCode,'' AS OriginalNum,mms_return.ReturnDate As TakeDate,
	    mms_returnDetail.MaterialCode,mms_returnDetail.Unit,mms_returnDetail.UnitPrice,
	    -mms_returnDetail.Num,-mms_returnDetail.Money,mms_returnDetail.Remark,mms_merchants.MerchantsName AS SupplierName,
        '' as name,(mms_return.BillNo+'return'+mms_returnDetail.MaterialCode) as id,mms_material.MaterialName,mms_material.Model
    From mms_returnDetail
    Left join mms_return ON mms_returnDetail.BillNo=mms_return.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_return.SupplierCode
    left join mms_material on mms_material.MaterialCode=mms_returnDetail.MaterialCode
    Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

    UNION

    --租赁进场
    Select mms_rentIn.BillNo As SrcBillNo,'rentin' As SrcBillType,mms_rentIn.ContractCode As ContractCode,
	    mms_rentIn.SupplierCode,'' as OriginalNum,mms_rentIn.RentInDate As TakeDate,
	    mms_rentInDetail.MaterialCode,mms_rentInDetail.Unit,mms_rentInDetail.UnitPrice,
	    mms_rentInDetail.Num,'0' as Money,mms_rentInDetail.Remark,mms_merchants.MerchantsName AS SupplierName,
        '' as name,(mms_rentIn.BillNo+'rentIn'+mms_rentInDetail.MaterialCode) as id,mms_material.MaterialName,mms_material.Model
    From mms_rentInDetail
    Left join mms_rentIn ON mms_rentInDetail.BillNo=mms_rentIn.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_rentIn.SupplierCode
    left join mms_material on mms_material.MaterialCode=mms_rentInDetail.MaterialCode
    Where mms_rentIn.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'
) as T
Where 1=1 
                
2014-05-27 23:01:48,470 [3880] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/warehousequery')
2014-05-27 23:01:48,474 [3880] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:01:48,479 [3880] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:01:54,617 [3880] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/warehouseaccount')
2014-05-27 23:01:58,360 [5416] DEBUG Mms - 
Select mms_warehouseStockHistory.*,mms_material.MaterialName,mms_material.Model,mms_material.Unit
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStockHistory.WarehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where  mms_warehouse.ProjectCode='201306030001' 
order by mms_warehouseStockHistory.CreateDate desc
                
2014-05-27 23:02:00,644 [5416] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/materialwarnning')
2014-05-27 23:02:01,774 [3880] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode=''
                
2014-05-27 23:02:02,235 [7804] DEBUG Mms - 
Select mms_materialWarnning.*,mms_material.MaterialName,mms_material.Model,mms_material.Unit
From mms_materialWarnning
Left join mms_material on mms_material.MaterialCode=mms_materialWarnning.MaterialCode
Where mms_materialWarnning.ProjectCode='201306030001' 
                
2014-05-27 23:02:04,637 [5416] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/balanceaccount')
2014-05-27 23:02:04,655 [5416] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:02:04,655 [5416] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:02:04,657 [5416] DEBUG Servicemms_buildPart - 获取动态列表
2014-05-27 23:02:04,658 [5416] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2014-05-27 23:02:05,576 [7804] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2014-05-27 23:02:05,871 [7804] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2014-05-27 23:02:06,596 [7804] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2014-05-27 23:02:22,424 [7804] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001' And mms_receive.WarehouseCode ='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001' And mms_return.WarehouseCode ='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001' And 1=0

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001' And 1=0

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001' And mms_stockAdjust.WarehouseCode ='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001' And mms_send.WarehouseCode ='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001' And mms_refund.WarehouseCode ='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001' And mms_transfer.WarehouseCode ='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001' And mms_lossReport.WarehouseCode ='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2014-05-27 23:02:22,646 [7804] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney0                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001' And mms_receive.WarehouseCode ='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001' And mms_return.WarehouseCode ='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001' And 1=0

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001' And 1=0

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001' And mms_stockAdjust.WarehouseCode ='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001' And mms_send.WarehouseCode ='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001' And mms_refund.WarehouseCode ='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001' And mms_transfer.WarehouseCode ='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001' And mms_lossReport.WarehouseCode ='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2014-05-27 23:02:22,891 [7804] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001' And mms_warehouseStockHistory.WarehouseCode ='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2014-05-27 23:02:29,031 [7804] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/balanceaccount')
2014-05-27 23:02:29,046 [7804] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:02:29,046 [7804] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:02:29,052 [7804] DEBUG Servicemms_buildPart - 获取动态列表
2014-05-27 23:02:29,053 [7804] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2014-05-27 23:02:30,199 [3880] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2014-05-27 23:02:30,205 [3880] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2014-05-27 23:02:30,216 [3880] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2014-05-27 23:02:38,599 [7660] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/direct/Index','/Mms/direct')
2014-05-27 23:02:38,622 [7660] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:02:38,622 [7660] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:02:38,627 [7660] DEBUG Servicesys_code - 获取动态列表
2014-05-27 23:02:38,627 [7660] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2014-05-27 23:02:42,516 [5260] DEBUG Servicemms_direct - 获取动态列表
2014-05-27 23:02:42,517 [5260] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName,D.MerchantsName as SupplierName,E.MerchantsName as PickUnitName
     from 
        mms_direct A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType     = A.MaterialType
        left join mms_merchants     D on D.MerchantsCode    = A.SupplierCode
        left join mms_merchants     E on E.MerchantsCode    = A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:02:42,562 [5260] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName,D.MerchantsName as SupplierName,E.MerchantsName as PickUnitName
     from 
        mms_direct A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType     = A.MaterialType
        left join mms_merchants     D on D.MerchantsCode    = A.SupplierCode
        left join mms_merchants     E on E.MerchantsCode    = A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:03:01,595 [7660] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/check/Index','/Mms/check')
2014-05-27 23:03:01,618 [7660] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:03:01,619 [7660] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:03:05,397 [7804] DEBUG Servicemms_check - 获取动态列表
2014-05-27 23:03:05,398 [7804] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName
     from 
        mms_check A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
     where  1=1and A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:03:05,421 [7804] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName
     from 
        mms_check A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
     where  1=1and A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:03:27,403 [7660] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2014-05-27 23:03:44,778 [3880] DEBUG Sys - update sys_userSetting set [SettingValue] = 'gray' where [UserCode] = 'admin' and [SettingCode] = 'theme'
2014-05-27 23:03:44,805 [3880] DEBUG Sys - insert into sys_userSetting([UserCode],[SettingCode],[SettingName],[SettingValue],[Description]) values('admin','theme','','gray','')
2014-05-27 23:03:44,812 [3880] DEBUG Sys - update sys_userSetting set [SettingValue] = 'accordion' where [UserCode] = 'admin' and [SettingCode] = 'navigation'
2014-05-27 23:03:44,821 [3880] DEBUG Sys - insert into sys_userSetting([UserCode],[SettingCode],[SettingName],[SettingValue],[Description]) values('admin','navigation','','accordion','')
2014-05-27 23:03:44,888 [3880] DEBUG Sys - update sys_userSetting set [SettingValue] = '20' where [UserCode] = 'admin' and [SettingCode] = 'gridrows'
2014-05-27 23:03:44,897 [3880] DEBUG Sys - insert into sys_userSetting([UserCode],[SettingCode],[SettingName],[SettingValue],[Description]) values('admin','gridrows','','20','')
2014-05-27 23:03:45,160 [7660] DEBUG Sys - update sys_userSetting set [SettingValue] = 'gray' where [UserCode] = 'admin' and [SettingCode] = 'theme'
2014-05-27 23:03:45,162 [7660] DEBUG Sys - update sys_userSetting set [SettingValue] = 'accordion' where [UserCode] = 'admin' and [SettingCode] = 'navigation'
2014-05-27 23:03:45,163 [7660] DEBUG Sys - update sys_userSetting set [SettingValue] = '20' where [UserCode] = 'admin' and [SettingCode] = 'gridrows'
2014-05-27 23:03:48,633 [4160] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2014-05-27 23:03:50,404 [7804] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2014-05-27 23:03:59,004 [7660] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/Index','/Mms/receive')
2014-05-27 23:03:59,009 [7660] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:03:59,010 [7660] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:03:59,011 [7660] DEBUG Servicesys_code - 获取动态列表
2014-05-27 23:03:59,011 [7660] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2014-05-27 23:04:00,543 [3880] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/refund/Index','/Mms/refund')
2014-05-27 23:04:00,567 [3880] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:04:00,568 [3880] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:04:01,710 [7660] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 23:04:01,711 [7660] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:04:01,715 [7660] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:04:03,272 [7804] DEBUG Servicemms_refund - 获取动态列表
2014-05-27 23:04:03,273 [7804] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as RefundUnitName
     from 
        mms_refund A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.RefundUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:04:03,299 [7804] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as RefundUnitName
     from 
        mms_refund A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.RefundUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:10:10,753 [5088] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/check/Index','/Mms/check')
2014-05-27 23:10:10,758 [5088] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:10:10,767 [5088] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:10:12,916 [7660] DEBUG Servicemms_check - 获取动态列表
2014-05-27 23:10:12,917 [7660] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName
     from 
        mms_check A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
     where  1=1and A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:10:12,919 [7660] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName
     from 
        mms_check A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
     where  1=1and A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:11:14,200 [5996] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/Index','/Mms/receive')
2014-05-27 23:11:14,204 [5996] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:11:14,204 [5996] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:11:14,205 [5996] DEBUG Servicesys_code - 获取动态列表
2014-05-27 23:11:14,206 [5996] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2014-05-27 23:11:16,921 [7660] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/send/Index','/Mms/send')
2014-05-27 23:11:16,941 [7660] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:11:16,942 [7660] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:11:16,943 [7660] DEBUG Servicesys_code - 获取动态列表
2014-05-27 23:11:16,944 [7660] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2014-05-27 23:11:16,946 [7660] DEBUG Servicesys_code - 获取动态列表
2014-05-27 23:11:16,947 [7660] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'MaterialUse'
2014-05-27 23:11:17,585 [6452] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 23:11:17,586 [6452] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:11:17,624 [6452] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:11:19,276 [7660] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2014-05-27 23:11:19,280 [7660] DEBUG Sys - 
select *
from sys_roleMenuColumnMap 
where MenuCode = '1001'
and RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
2014-05-27 23:11:19,405 [7660] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2014-05-27 23:11:19,408 [7660] DEBUG Sys - 
select A.*
from sys_button A
inner join sys_roleMenuButtonMap B on B.MenuCode = '1001' and B.ButtonCode = A.ButtonCode
where RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
order by ButtonSeq
2014-05-27 23:11:21,065 [7660] DEBUG Servicemms_send - 获取动态列表
2014-05-27 23:11:21,065 [7660] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:11:21,090 [7660] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:33:27,672 [2176] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 23:33:28,086 [2176] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 23:33:28,153 [2176] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 23:33:28,225 [2176] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2014-05-27 23:33:29,207 [8840] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/direct/Index','/Mms/direct')
2014-05-27 23:33:29,299 [8840] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:33:29,343 [8840] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:33:29,349 [8840] DEBUG Servicesys_code - 获取动态列表
2014-05-27 23:33:29,350 [8840] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2014-05-27 23:33:36,424 [7652] DEBUG Servicemms_direct - 获取动态列表
2014-05-27 23:33:36,425 [7652] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName,D.MerchantsName as SupplierName,E.MerchantsName as PickUnitName
     from 
        mms_direct A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType     = A.MaterialType
        left join mms_merchants     D on D.MerchantsCode    = A.SupplierCode
        left join mms_merchants     E on E.MerchantsCode    = A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:33:36,602 [7652] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName,D.MerchantsName as SupplierName,E.MerchantsName as PickUnitName
     from 
        mms_direct A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType     = A.MaterialType
        left join mms_merchants     D on D.MerchantsCode    = A.SupplierCode
        left join mms_merchants     E on E.MerchantsCode    = A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:47:46,370 [7652] DEBUG Servicesys_user - 获取实体对象
2014-05-27 23:47:46,461 [7652] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  '1234'and IsEnable =  'True'
2014-05-27 23:47:46,662 [7652] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'admin' 
2014-05-27 23:47:48,551 [7652] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('admin','管理员','henley-PC','localhost','','2014/5/27 23:47:48')
2014-05-27 23:47:48,672 [7652] DEBUG Servicemms_project - 获取实体对象
2014-05-27 23:47:48,680 [7652] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2014-05-27 23:47:49,087 [7652] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2014-05-27 23:47:52,918 [8812] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2014-05-27 23:48:12,213 [8864] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/refund/Index','/Mms/refund')
2014-05-27 23:48:12,251 [8864] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:48:12,251 [8864] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:48:15,791 [8840] DEBUG Servicemms_refund - 获取动态列表
2014-05-27 23:48:15,793 [8840] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as RefundUnitName
     from 
        mms_refund A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.RefundUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:48:15,886 [8840] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as RefundUnitName
     from 
        mms_refund A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.RefundUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:48:17,869 [1276] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/refund/edit')
2014-05-27 23:48:18,091 [1276] DEBUG Servicemms_refund - 获取实体对象
2014-05-27 23:48:18,092 [1276] DEBUG Mms - select mms_refund.* from mms_refund where  BillNo =  '201307050001'
2014-05-27 23:48:18,275 [1276] DEBUG Servicemms_refund - 获取上一条下一条数据
2014-05-27 23:48:18,347 [1276] DEBUG Servicemms_refund - 获取字段
2014-05-27 23:48:18,349 [1276] DEBUG Mms - select top 1 BillNo from mms_refund where  ProjectCode =  '201306030001' order by BillNo
2014-05-27 23:48:18,376 [1276] DEBUG Servicemms_refund - 获取字段
2014-05-27 23:48:18,377 [1276] DEBUG Mms - select top 1 BillNo from mms_refund where  BillNo < '201307050001'and ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 23:48:18,464 [1276] DEBUG Servicemms_refund - 获取字段
2014-05-27 23:48:18,465 [1276] DEBUG Mms - select top 1 BillNo from mms_refund where  BillNo >  '201307050001'and ProjectCode =  '201306030001' order by BillNo
2014-05-27 23:48:18,477 [1276] DEBUG Servicemms_refund - 获取字段
2014-05-27 23:48:18,477 [1276] DEBUG Mms - select top 1 BillNo from mms_refund where  ProjectCode =  '201306030001' order by BillNo desc
2014-05-27 23:48:18,613 [1276] DEBUG Servicesys_code - 获取动态列表
2014-05-27 23:48:18,615 [1276] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2014-05-27 23:48:18,636 [1276] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:48:18,636 [1276] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:48:22,924 [2596] DEBUG ServiceModelBase - 获取动态列表
2014-05-27 23:48:22,926 [2596] DEBUG Mms - select 
    MerchantsCode   as   value,MerchantsName   as   text
   from 
    mms_merchants A
    left join mms_merchantsType B on B.MerchantsTypeCode = A.MerchantsTypeCode
   where  MerchantsCode in ('FB00506') order by MerchantsCode
2014-05-27 23:48:24,159 [1276] DEBUG Servicemms_refund - 获取动态列表
2014-05-27 23:48:24,160 [1276] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material,C.UnitPrice as SrcUnitPrice,C.Num as SrcNum
     from 
        mms_refundDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
        left join mms_sendDetail C on C.BillNo =  A.SrcBillNo and C.RowId = A.SrcRowId
     where  A.BillNo =  '201307050001' order by A.MaterialCode
2014-05-27 23:48:44,498 [8864] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/Index','/Mms/receive')
2014-05-27 23:48:44,759 [8864] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:48:44,759 [8864] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:48:44,764 [8864] DEBUG Servicesys_code - 获取动态列表
2014-05-27 23:48:44,764 [8864] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2014-05-27 23:48:46,996 [7652] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 23:48:46,997 [7652] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:48:47,068 [7652] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:49:09,829 [7652] DEBUG Servicemms_receive - 获取动态列表
2014-05-27 23:49:09,910 [7652] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  datediff(day,'2014-05-01 ',ReceiveDate) >=0 and datediff(day,' 2014-05-27',ReceiveDate)<=0and A.ProjectCode =  '201306030001' order by A.BillNo
2014-05-27 23:49:10,293 [7652] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  datediff(day,'2014-05-01 ',ReceiveDate) >=0 and datediff(day,' 2014-05-27',ReceiveDate)<=0and A.ProjectCode =  '201306030001' ) tb_temp
2014-05-27 23:49:18,272 [2668] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/role/Index','/Sys/role')
2014-05-27 23:49:18,396 [2668] DEBUG Servicesys_user - 获取动态列表
2014-05-27 23:49:18,397 [2668] DEBUG Sys - select UserCode,UserName from sys_user
2014-05-27 23:49:18,462 [2668] DEBUG Servicesys_organize - 获取动态列表
2014-05-27 23:49:18,465 [2668] DEBUG Sys - select OrganizeCode,OrganizeName from sys_organize
2014-05-27 23:49:19,988 [7652] DEBUG Servicesys_role - 获取实体列表
2014-05-27 23:49:19,990 [7652] DEBUG Sys - select sys_role.* from sys_role order by RoleSeq
2014-05-27 23:49:39,767 [2668] DEBUG Servicesys_role - 编辑记录
2014-05-27 23:49:39,795 [2668] DEBUG Servicesys_role - 获取动态对象
2014-05-27 23:49:40,136 [2668] DEBUG Sys - select 
        sys_role
    .* from 
        sys_role
     where  RoleCode =  ''
2014-05-27 23:49:40,224 [2668] DEBUG Sys - insert into 
        sys_role
    ([UpdatePerson],[UpdateDate],[CreatePerson],[CreateDate]) values('管理员','2014/5/27 23:49:40','管理员','2014/5/27 23:49:40')
2014-05-27 23:49:40,976 [2668] ERROR Servicesys_role - 编辑记录失败
System.Data.SqlClient.SqlException (0x80131904): 不能将值 NULL 插入列 'RoleCode'，表 'Zephyr.Sys.dbo.sys_role'；列不允许有 Null 值。INSERT 失败。
语句已终止。
   在 Zephyr.Data.ExecuteQueryHandler.HandleQueryException(Exception exception) 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Data\Command\Handlers\ExecuteQueryHandler.cs:行号 107
   在 Zephyr.Data.ExecuteQueryHandler.ExecuteQuery(Boolean useReader, Action action) 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Data\Command\Handlers\ExecuteQueryHandler.cs:行号 28
   在 Zephyr.Data.DbCommand.Execute() 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Data\Command\PartialClasses\Execute.cs:行号 9
   在 Zephyr.Data.BaseInsertBuilder.Execute() 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Data\Builders\Insert\BaseInsertBuilder.cs:行号 22
   在 Zephyr.Core.ServiceBase`1.<Edit>b__51(RequestWrapper x) 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Core\Base\ServiceBaseEdit.cs:行号 62
   在 Zephyr.Core.ServiceBase`1.<>c__DisplayClass55.<Edit>b__52() 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Core\Base\ServiceBaseEdit.cs:行号 119
   在 Zephyr.Core.LogHelper.Logger(ILog log, String function, ErrorHandle errorHandleType, Action tryHandle, Action`1 catchHandle, Action finallyHandle) 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Core\Logs\LogHelper.cs:行号 44
ClientConnectionId:e4f3697c-0b2c-45be-a2d1-ca3cd25347f2
2014-05-27 23:49:41,477 [2668] ERROR /api/sys/role/edit - System.Data.SqlClient.SqlException (0x80131904): 不能将值 NULL 插入列 'RoleCode'，表 'Zephyr.Sys.dbo.sys_role'；列不允许有 Null 值。INSERT 失败。
语句已终止。
   在 Zephyr.Core.LogHelper.Logger(ILog log, String function, ErrorHandle errorHandleType, Action tryHandle, Action`1 catchHandle, Action finallyHandle) 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Core\Logs\LogHelper.cs:行号 54
   在 Zephyr.Core.ServiceBase`1.Logger(String function, Action tryHandle, Action`1 catchHandle, Action finallyHandle) 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Core\Base\ServiceBaseLog.cs:行号 23
   在 Zephyr.Core.ServiceBase`1.Edit(RequestWrapper formWrapper, RequestWrapper listWrapper, JObject data) 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Net\Zephyr.Core\Base\ServiceBaseEdit.cs:行号 68
   在 CallSite.Target(Closure , CallSite , sys_roleService , Object , RequestWrapper , Object )
   在 System.Dynamic.UpdateDelegates.UpdateAndExecute4[T0,T1,T2,T3,TRet](CallSite site, T0 arg0, T1 arg1, T2 arg2, T3 arg3)
   在 Zephyr.Areas.Sys.Controllers.RoleApiController.Edit(Object data) 位置 d:\Workspaces\Zephyr.Net源代码\Zephyr.Net源代码\source20131023\Zephyr.Web\Areas\Sys\Controllers\RoleController.cs:行号 70
   在 lambda_method(Closure , Object , Object[] )
   在 System.Web.Http.Controllers.ReflectedHttpActionDescriptor.ActionExecutor.<>c__DisplayClassf.<GetExecutor>b__9(Object instance, Object[] methodParameters)
   在 System.Web.Http.Controllers.ReflectedHttpActionDescriptor.ActionExecutor.Execute(Object instance, Object[] arguments)
   在 System.Web.Http.Controllers.ReflectedHttpActionDescriptor.<>c__DisplayClass5.<ExecuteAsync>b__4()
   在 System.Threading.Tasks.TaskHelpers.RunSynchronously[TResult](Func`1 func, CancellationToken cancellationToken)
ClientConnectionId:e4f3697c-0b2c-45be-a2d1-ca3cd25347f2
2014-05-27 23:50:14,281 [8864] DEBUG Sys - select * from sys_button order by ButtonSeq
2014-05-27 23:50:14,317 [8864] DEBUG Sys - select A.MenuName,A.MenuCode,A.ParentCode,A.IconClass as iconCls,B.MenuName as ParentName,(select 1 from sys_roleMenuMap tb_role where tb_role.RoleCode='R5' and tb_role.MenuCode=A.MenuCode) as checked,(
select case when max(tb1_add.ID) is null then -1 
            when max(tb2_add.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_add
left join sys_roleMenuButtonMap AS tb2_add ON tb2_add.MenuCode=tb1_add.MenuCode AND tb2_add.ButtonCode=tb1_add.ButtonCode AND tb2_add.RoleCode='R5'
where tb1_add.MenuCode = A.MenuCode and  tb1_add.ButtonCode = 'add'  
)as 'btn_add' ,(
select case when max(tb1_browse.ID) is null then -1 
            when max(tb2_browse.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_browse
left join sys_roleMenuButtonMap AS tb2_browse ON tb2_browse.MenuCode=tb1_browse.MenuCode AND tb2_browse.ButtonCode=tb1_browse.ButtonCode AND tb2_browse.RoleCode='R5'
where tb1_browse.MenuCode = A.MenuCode and  tb1_browse.ButtonCode = 'browse'  
)as 'btn_browse' ,(
select case when max(tb1_edit.ID) is null then -1 
            when max(tb2_edit.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_edit
left join sys_roleMenuButtonMap AS tb2_edit ON tb2_edit.MenuCode=tb1_edit.MenuCode AND tb2_edit.ButtonCode=tb1_edit.ButtonCode AND tb2_edit.RoleCode='R5'
where tb1_edit.MenuCode = A.MenuCode and  tb1_edit.ButtonCode = 'edit'  
)as 'btn_edit' ,(
select case when max(tb1_delete.ID) is null then -1 
            when max(tb2_delete.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_delete
left join sys_roleMenuButtonMap AS tb2_delete ON tb2_delete.MenuCode=tb1_delete.MenuCode AND tb2_delete.ButtonCode=tb1_delete.ButtonCode AND tb2_delete.RoleCode='R5'
where tb1_delete.MenuCode = A.MenuCode and  tb1_delete.ButtonCode = 'delete'  
)as 'btn_delete' ,(
select case when max(tb1_search.ID) is null then -1 
            when max(tb2_search.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_search
left join sys_roleMenuButtonMap AS tb2_search ON tb2_search.MenuCode=tb1_search.MenuCode AND tb2_search.ButtonCode=tb1_search.ButtonCode AND tb2_search.RoleCode='R5'
where tb1_search.MenuCode = A.MenuCode and  tb1_search.ButtonCode = 'search'  
)as 'btn_search' ,(
select case when max(tb1_refresh.ID) is null then -1 
            when max(tb2_refresh.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_refresh
left join sys_roleMenuButtonMap AS tb2_refresh ON tb2_refresh.MenuCode=tb1_refresh.MenuCode AND tb2_refresh.ButtonCode=tb1_refresh.ButtonCode AND tb2_refresh.RoleCode='R5'
where tb1_refresh.MenuCode = A.MenuCode and  tb1_refresh.ButtonCode = 'refresh'  
)as 'btn_refresh' ,(
select case when max(tb1_export.ID) is null then -1 
            when max(tb2_export.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_export
left join sys_roleMenuButtonMap AS tb2_export ON tb2_export.MenuCode=tb1_export.MenuCode AND tb2_export.ButtonCode=tb1_export.ButtonCode AND tb2_export.RoleCode='R5'
where tb1_export.MenuCode = A.MenuCode and  tb1_export.ButtonCode = 'export'  
)as 'btn_export' ,(
select case when max(tb1_download.ID) is null then -1 
            when max(tb2_download.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_download
left join sys_roleMenuButtonMap AS tb2_download ON tb2_download.MenuCode=tb1_download.MenuCode AND tb2_download.ButtonCode=tb1_download.ButtonCode AND tb2_download.RoleCode='R5'
where tb1_download.MenuCode = A.MenuCode and  tb1_download.ButtonCode = 'download'  
)as 'btn_download' ,(
select case when max(tb1_print.ID) is null then -1 
            when max(tb2_print.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_print
left join sys_roleMenuButtonMap AS tb2_print ON tb2_print.MenuCode=tb1_print.MenuCode AND tb2_print.ButtonCode=tb1_print.ButtonCode AND tb2_print.RoleCode='R5'
where tb1_print.MenuCode = A.MenuCode and  tb1_print.ButtonCode = 'print'  
)as 'btn_print' ,(
select case when max(tb1_accredit.ID) is null then -1 
            when max(tb2_accredit.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_accredit
left join sys_roleMenuButtonMap AS tb2_accredit ON tb2_accredit.MenuCode=tb1_accredit.MenuCode AND tb2_accredit.ButtonCode=tb1_accredit.ButtonCode AND tb2_accredit.RoleCode='R5'
where tb1_accredit.MenuCode = A.MenuCode and  tb1_accredit.ButtonCode = 'accredit'  
)as 'btn_accredit' ,(
select case when max(tb1_audit.ID) is null then -1 
            when max(tb2_audit.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_audit
left join sys_roleMenuButtonMap AS tb2_audit ON tb2_audit.MenuCode=tb1_audit.MenuCode AND tb2_audit.ButtonCode=tb1_audit.ButtonCode AND tb2_audit.RoleCode='R5'
where tb1_audit.MenuCode = A.MenuCode and  tb1_audit.ButtonCode = 'audit'  
)as 'btn_audit' ,(
select case when max(tb1_inport.ID) is null then -1 
            when max(tb2_inport.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_inport
left join sys_roleMenuButtonMap AS tb2_inport ON tb2_inport.MenuCode=tb1_inport.MenuCode AND tb2_inport.ButtonCode=tb1_inport.ButtonCode AND tb2_inport.RoleCode='R5'
where tb1_inport.MenuCode = A.MenuCode and  tb1_inport.ButtonCode = 'inport'  
)as 'btn_inport' ,(
select case when max(tb1_copy.ID) is null then -1 
            when max(tb2_copy.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_copy
left join sys_roleMenuButtonMap AS tb2_copy ON tb2_copy.MenuCode=tb1_copy.MenuCode AND tb2_copy.ButtonCode=tb1_copy.ButtonCode AND tb2_copy.RoleCode='R5'
where tb1_copy.MenuCode = A.MenuCode and  tb1_copy.ButtonCode = 'copy'  
)as 'btn_copy' ,(
select case when max(tb1_save.ID) is null then -1 
            when max(tb2_save.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_save
left join sys_roleMenuButtonMap AS tb2_save ON tb2_save.MenuCode=tb1_save.MenuCode AND tb2_save.ButtonCode=tb1_save.ButtonCode AND tb2_save.RoleCode='R5'
where tb1_save.MenuCode = A.MenuCode and  tb1_save.ButtonCode = 'save'  
)as 'btn_save' 
from sys_menu as A
left join sys_menu B on B.MenuCode = A.ParentCode
where A.IsEnable = 1
order by A.MenuSeq,A.MenuCode
2014-05-27 23:50:14,361 [2668] DEBUG Servicesys_permission - 获取动态列表
2014-05-27 23:50:14,371 [2668] DEBUG Sys - select A.*
,case when B.PermissionCode is null then 0 else 1           end as checked
,case when B.PermissionCode is null then 0 else B.IsDefault end as IsDefault from sys_permission A
left join sys_rolePermissionMap B on B.RoleCode='R5' and B.PermissionCode = A.PermissionCode 
2014-05-27 23:50:16,337 [8864] DEBUG Sys - select * from sys_roleMenuColumnMap where RoleCode = 'R5'
2014-05-27 23:50:23,382 [8812] DEBUG Sys - 
 select A1.UserName as MemberName ,A1.UserCode as MemberCode,'user' as MemberType
  from sys_user A1
 where A1.UserCode in (select B1.UserCode from sys_userRoleMap B1 where B1.RoleCode = 'R3')
union
 select A2.OrganizeName as MemberName ,A2.OrganizeCode as MemberCode,'organize' as MemberType
   from sys_organize A2
  where A2.OrganizeCode in (select B2.OrganizeCode from sys_organizeRoleMap B2 where B2.RoleCode = 'R3')
2014-05-27 23:50:33,920 [8864] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/user/Index','/Sys/user')
2014-05-27 23:50:36,208 [2668] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/code/Index','/Sys/code')
2014-05-27 23:50:36,726 [2596] DEBUG Servicesys_user - 获取实体列表
2014-05-27 23:50:36,727 [2596] DEBUG Sys - select top 20 sys_user.* from sys_user order by UserSeq
2014-05-27 23:50:36,773 [2596] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user ) tb_temp
2014-05-27 23:50:36,839 [8904] DEBUG Servicesys_organize - 获取实体列表
2014-05-27 23:50:36,841 [8904] DEBUG Sys - select sys_organize.* from sys_organize
2014-05-27 23:50:38,040 [8840] DEBUG Servicesys_codeType - 获取动态列表
2014-05-27 23:50:38,041 [8840] DEBUG Sys - select sys_codeType.* from sys_codeType order by Seq,CodeType
2014-05-27 23:50:38,299 [8864] DEBUG Servicesys_code - 获取实体列表
2014-05-27 23:50:38,300 [8864] DEBUG Sys - select top 20 sys_code.* from sys_code order by Seq
2014-05-27 23:50:38,357 [8864] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code ) tb_temp
2014-05-27 23:50:44,907 [1276] DEBUG Servicesys_code - 获取实体列表
2014-05-27 23:50:44,908 [1276] DEBUG Sys - select top 20 sys_code.* from sys_code where  CodeType =  'FundSource' order by Seq
2014-05-27 23:50:45,020 [1276] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code where  CodeType =  'FundSource' ) tb_temp
2014-05-27 23:51:09,083 [2596] DEBUG Servicesys_code - 获取实体列表
2014-05-27 23:51:09,083 [2596] DEBUG Sys - select top 20 sys_code.* from sys_code where  CodeType =  'BuildingCategories' order by Seq
2014-05-27 23:51:09,114 [2596] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code where  CodeType =  'BuildingCategories' ) tb_temp
2014-05-27 23:51:13,855 [8864] DEBUG Servicesys_code - 获取实体列表
2014-05-27 23:51:13,856 [8864] DEBUG Sys - select top 20 sys_code.* from sys_code where  CodeType =  'MeasureUnit' order by Seq
2014-05-27 23:51:13,886 [8864] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code where  CodeType =  'MeasureUnit' ) tb_temp
2014-05-27 23:51:30,383 [7652] DEBUG Servicesys_code - 编辑记录
2014-05-27 23:51:30,385 [7652] DEBUG Servicesys_code - 获取动态对象
2014-05-27 23:51:30,388 [7652] DEBUG Sys - select sys_code.* from sys_code where  Code =  '058'
2014-05-27 23:51:30,426 [7652] DEBUG Sys - update sys_code set [CodeType] = 'MeasureUnit', [Value] = 'SquareMeters', [Text] = '平方米', [ParentCode] = '01', [Description] = '', [IsEnable] = 'true', [IsDefault] = 'false', [Seq] = '17', [UpdatePerson] = '管理员', [UpdateDate] = '2014/5/27 23:51:30' where  Code =  '058'
2014-05-27 23:51:39,951 [1276] DEBUG Servicesys_code - 获取实体列表
2014-05-27 23:51:39,952 [1276] DEBUG Sys - with PagedPersons as
								(
									select top 100 percent sys_code.*, row_number() over (order by Seq) as FLUENTDATA_ROWNUMBER
									 from sys_code where  CodeType =  'MeasureUnit'
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 21 and 40
2014-05-27 23:51:42,259 [1276] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code where  CodeType =  'MeasureUnit' ) tb_temp
2014-05-27 23:51:46,224 [2668] DEBUG Servicesys_codeType - 获取动态列表
2014-05-27 23:51:46,224 [2668] DEBUG Sys - select top 10 sys_codeType.* from sys_codeType order by Seq,CodeType
2014-05-27 23:51:46,233 [2668] DEBUG Sys - select count(*) from ( select sys_codeType.* from sys_codeType ) tb_temp
2014-05-27 23:51:50,666 [8904] DEBUG Servicesys_codeType - 获取动态列表
2014-05-27 23:51:50,666 [8904] DEBUG Sys - with PagedPersons as
								(
									select top 100 percent sys_codeType.*, row_number() over (order by Seq,CodeType) as FLUENTDATA_ROWNUMBER
									 from sys_codeType
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 11 and 20
2014-05-27 23:51:50,727 [8904] DEBUG Sys - select count(*) from ( select sys_codeType.* from sys_codeType ) tb_temp
2014-05-27 23:51:51,868 [2668] DEBUG Servicesys_codeType - 获取动态列表
2014-05-27 23:51:51,869 [2668] DEBUG Sys - with PagedPersons as
								(
									select top 100 percent sys_codeType.*, row_number() over (order by Seq,CodeType) as FLUENTDATA_ROWNUMBER
									 from sys_codeType
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 21 and 30
2014-05-27 23:51:51,883 [2668] DEBUG Sys - select count(*) from ( select sys_codeType.* from sys_codeType ) tb_temp
2014-05-27 23:51:56,311 [2596] DEBUG Servicesys_codeType - 获取动态列表
2014-05-27 23:51:56,311 [2596] DEBUG Sys - with PagedPersons as
								(
									select top 100 percent sys_codeType.*, row_number() over (order by Seq,CodeType) as FLUENTDATA_ROWNUMBER
									 from sys_codeType
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 11 and 20
2014-05-27 23:51:56,331 [2596] DEBUG Sys - select count(*) from ( select sys_codeType.* from sys_codeType ) tb_temp
2014-05-27 23:51:56,870 [8864] DEBUG Servicesys_codeType - 获取动态列表
2014-05-27 23:51:56,870 [8864] DEBUG Sys - select top 10 sys_codeType.* from sys_codeType order by Seq,CodeType
2014-05-27 23:51:56,877 [8864] DEBUG Sys - select count(*) from ( select sys_codeType.* from sys_codeType ) tb_temp
2014-05-27 23:52:04,247 [8864] DEBUG Servicesys_code - 获取实体列表
2014-05-27 23:52:04,248 [8864] DEBUG Sys - with PagedPersons as
								(
									select top 100 percent sys_code.*, row_number() over (order by Seq) as FLUENTDATA_ROWNUMBER
									 from sys_code where  CodeType =  'MaterialType'
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 21 and 40
2014-05-27 23:52:04,304 [8864] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code where  CodeType =  'MaterialType' ) tb_temp
2014-05-27 23:52:11,775 [8904] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/parameter/Index','/Sys/parameter')
2014-05-27 23:52:13,453 [8864] DEBUG Servicesys_parameter - 获取实体列表
2014-05-27 23:52:13,454 [8864] DEBUG Sys - select top 20 sys_parameter.* from sys_parameter order by ParamCode
2014-05-27 23:52:13,511 [8864] DEBUG Sys - select count(*) from ( select sys_parameter.* from sys_parameter ) tb_temp
2014-05-27 23:52:31,385 [7652] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/log/Index','/Sys/log')
2014-05-27 23:52:31,722 [1276] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/log/Index','/Sys/log')
2014-05-27 23:52:33,915 [2668] DEBUG Servicesys_log - 获取实体列表
2014-05-27 23:52:33,917 [2668] DEBUG Sys - select top 20 
        A.*
     from 
        sys_log A
     order by A.ID desc
2014-05-27 23:52:33,920 [8904] DEBUG Servicesys_loginHistory - 获取实体列表
2014-05-27 23:52:33,921 [8904] DEBUG Sys - select top 20 
        A.*
     from 
        sys_loginHistory A
     order by A.ID desc
2014-05-27 23:52:33,947 [8904] DEBUG Sys - select count(*) from ( select 
        A.*
     from 
        sys_loginHistory A
     ) tb_temp
2014-05-27 23:52:34,229 [2668] DEBUG Sys - select count(*) from ( select 
        A.*
     from 
        sys_log A
     ) tb_temp
2014-05-27 23:53:21,743 [8840] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/parameter/Index','/Sys/parameter')
2014-05-27 23:53:22,572 [8812] DEBUG Servicesys_parameter - 获取实体列表
2014-05-27 23:53:22,572 [8812] DEBUG Sys - select top 20 sys_parameter.* from sys_parameter order by ParamCode
2014-05-27 23:53:22,577 [8812] DEBUG Sys - select count(*) from ( select sys_parameter.* from sys_parameter ) tb_temp
2014-05-27 23:53:24,208 [2668] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/code/Index','/Sys/code')
2014-05-27 23:53:24,935 [1276] DEBUG Servicesys_codeType - 获取动态列表
2014-05-27 23:53:24,936 [1276] DEBUG Sys - select sys_codeType.* from sys_codeType order by Seq,CodeType
2014-05-27 23:53:25,205 [2596] DEBUG Servicesys_code - 获取实体列表
2014-05-27 23:53:25,205 [2596] DEBUG Sys - select top 20 sys_code.* from sys_code order by Seq
2014-05-27 23:53:25,214 [2596] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code ) tb_temp
2014-05-27 23:53:31,583 [8840] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2014-05-27 23:53:32,096 [8864] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2014-05-27 23:53:32,887 [2596] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/code/Index','/Sys/code')
2014-05-27 23:53:33,399 [2668] DEBUG Servicesys_codeType - 获取动态列表
2014-05-27 23:53:33,399 [2668] DEBUG Sys - select sys_codeType.* from sys_codeType order by Seq,CodeType
2014-05-27 23:53:33,606 [8840] DEBUG Servicesys_code - 获取实体列表
2014-05-27 23:53:33,606 [8840] DEBUG Sys - select top 20 sys_code.* from sys_code order by Seq
2014-05-27 23:53:33,609 [8840] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code ) tb_temp
2014-05-27 23:53:43,344 [7652] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/organize/Index','/Sys/organize')
2014-05-27 23:53:43,403 [7652] DEBUG Servicesys_organize - 获取实体列表
2014-05-27 23:53:43,403 [7652] DEBUG Sys - select sys_organize.* from sys_organize
2014-05-27 23:55:09,485 [8840] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/menu/Index','/Sys/menu')
2014-05-27 23:55:11,281 [2596] DEBUG Servicesys_menu - 获取动态列表
2014-05-27 23:55:11,281 [2596] DEBUG Sys - select A.*,B.MenuName as ParentName from sys_menu A left join sys_menu B on B.MenuCode = A.ParentCode order by A.MenuSeq,A.MenuCode
2014-05-27 23:55:38,669 [8864] DEBUG Sys - 
select A.*,
       case when B.ID is null then 0 else 1 end as Selected
from sys_button A
left join sys_menuButtonMap B on B.MenuCode = '0103' and B.ButtonCode = A.ButtonCode
order by ButtonSeq
2014-05-27 23:55:46,146 [2668] DEBUG Servicesys_button - 获取实体列表
2014-05-27 23:55:46,147 [2668] DEBUG Sys - select sys_button.* from sys_button order by ButtonSeq
2014-05-27 23:55:58,284 [8864] DEBUG Servicesys_button - 获取实体列表
2014-05-27 23:55:58,285 [8864] DEBUG Sys - select sys_button.* from sys_button order by ButtonSeq
2014-05-27 23:56:08,683 [8812] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/organize/Index','/Sys/organize')
2014-05-27 23:56:08,698 [8812] DEBUG Servicesys_organize - 获取实体列表
2014-05-27 23:56:08,698 [8812] DEBUG Sys - select sys_organize.* from sys_organize
2014-05-27 23:56:13,437 [7652] DEBUG Sys - 
select distinct A.RoleCode,A.RoleName
,(case when B.RoleCode is null then 'false' else 'true' end) as Checked
from sys_role A
left join sys_organizeRoleMap B on B.RoleCode = A.RoleCode and B.OrganizeCode = '040503'
2014-05-27 23:56:20,974 [8864] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/user/Index','/Sys/user')
2014-05-27 23:56:21,866 [8904] DEBUG Servicesys_organize - 获取实体列表
2014-05-27 23:56:21,867 [8904] DEBUG Sys - select sys_organize.* from sys_organize
2014-05-27 23:56:21,943 [2668] DEBUG Servicesys_user - 获取实体列表
2014-05-27 23:56:21,943 [2668] DEBUG Sys - select top 20 sys_user.* from sys_user order by UserSeq
2014-05-27 23:56:21,970 [2668] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user ) tb_temp
2014-05-27 23:56:34,636 [2596] DEBUG Servicesys_user - 获取实体列表
2014-05-27 23:56:34,637 [2596] DEBUG Sys - select top 20 sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040503'))) order by UserSeq
2014-05-27 23:56:35,649 [2596] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040503'))) ) tb_temp
2014-05-27 23:56:40,386 [7652] DEBUG Servicesys_user - 获取实体列表
2014-05-27 23:56:40,386 [7652] DEBUG Sys - select top 20 sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040504'))) order by UserSeq
2014-05-27 23:56:40,546 [7652] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040504'))) ) tb_temp
2014-05-27 23:56:41,689 [2668] DEBUG Servicesys_user - 获取实体列表
2014-05-27 23:56:41,690 [2668] DEBUG Sys - select top 20 sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040505'))) order by UserSeq
2014-05-27 23:56:41,801 [2668] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040505'))) ) tb_temp
2014-05-27 23:58:10,686 [7652] DEBUG Servicesys_user - 获取实体列表
2014-05-27 23:58:10,687 [7652] DEBUG Sys - select top 20 sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','04'))) order by UserSeq
2014-05-27 23:58:10,779 [7652] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','04'))) ) tb_temp
2014-05-27 23:58:26,755 [2668] DEBUG Sys - 
select distinct A.OrganizeCode,A.OrganizeName,A.ParentCode
,(case when B.UserCode is null then 'false' else 'true' end) as Checked
from sys_organize A
left join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode and B.UserCode = 'zfg'
2014-05-27 23:58:39,389 [8840] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/role/Index','/Sys/role')
2014-05-27 23:58:39,504 [8840] DEBUG Servicesys_user - 获取动态列表
2014-05-27 23:58:39,504 [8840] DEBUG Sys - select UserCode,UserName from sys_user
2014-05-27 23:58:39,554 [8840] DEBUG Servicesys_organize - 获取动态列表
2014-05-27 23:58:39,554 [8840] DEBUG Sys - select OrganizeCode,OrganizeName from sys_organize
2014-05-27 23:58:40,165 [2668] DEBUG Servicesys_role - 获取实体列表
2014-05-27 23:58:40,166 [2668] DEBUG Sys - select sys_role.* from sys_role order by RoleSeq
2014-05-27 23:58:45,010 [8904] DEBUG Sys - 
 select A1.UserName as MemberName ,A1.UserCode as MemberCode,'user' as MemberType
  from sys_user A1
 where A1.UserCode in (select B1.UserCode from sys_userRoleMap B1 where B1.RoleCode = 'Manage')
union
 select A2.OrganizeName as MemberName ,A2.OrganizeCode as MemberCode,'organize' as MemberType
   from sys_organize A2
  where A2.OrganizeCode in (select B2.OrganizeCode from sys_organizeRoleMap B2 where B2.RoleCode = 'Manage')
2014-05-27 23:58:52,992 [8904] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/merchant/Index','/Mms/merchant')
2014-05-27 23:58:54,834 [8840] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 23:58:54,844 [8840] DEBUG Mms - select top 20 mms_merchants.* from mms_merchants order by MerchantsCode
2014-05-27 23:58:54,861 [2596] DEBUG Servicemms_merchantsType - 获取动态列表
2014-05-27 23:58:54,868 [2596] DEBUG Mms - select mms_merchantsType.* from mms_merchantsType order by MerchantsTypeCode
2014-05-27 23:58:54,891 [8840] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants ) tb_temp
2014-05-27 23:59:12,843 [8904] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 23:59:12,844 [8904] DEBUG Mms - select top 20 mms_merchants.* from mms_merchants where  MerchantsTypeCode =  '003' order by MerchantsCode
2014-05-27 23:59:12,871 [8904] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants where  MerchantsTypeCode =  '003' ) tb_temp
2014-05-27 23:59:16,429 [8812] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 23:59:16,429 [8812] DEBUG Mms - select top 20 mms_merchants.* from mms_merchants where  MerchantsTypeCode =  '002' order by MerchantsCode
2014-05-27 23:59:16,459 [8812] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants where  MerchantsTypeCode =  '002' ) tb_temp
2014-05-27 23:59:18,005 [2668] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 23:59:18,005 [2668] DEBUG Mms - select top 20 mms_merchants.* from mms_merchants order by MerchantsCode
2014-05-27 23:59:18,012 [2668] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants ) tb_temp
2014-05-27 23:59:19,752 [8864] DEBUG Servicemms_merchants - 获取实体列表
2014-05-27 23:59:19,753 [8864] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent mms_merchants.*, row_number() over (order by MerchantsCode) as FLUENTDATA_ROWNUMBER
									 from mms_merchants
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 21 and 40
2014-05-27 23:59:19,818 [8864] DEBUG Mms - select count(*) from ( select mms_merchants.* from mms_merchants ) tb_temp
2014-05-27 23:59:22,723 [8864] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/warehousequery')
2014-05-27 23:59:22,756 [8864] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:59:22,756 [8864] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:59:24,926 [2596] DEBUG Mms - 
Select mms_warehouseStock.*,mms_material.MaterialName,mms_material.Model,mms_warehouse.WarehouseName,
    mms_warehouseStock.WarehouseCode+'_'+mms_material.MaterialCode as id,'' AS name
From mms_warehouseStock
Left join mms_warehouse on mms_warehouseStock.WarehouseCode=mms_warehouse.WarehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStock.MaterialCode
Where mms_warehouse.ProjectCode='201306030001' 

                
2014-05-27 23:59:25,263 [8840] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/warehousequery')
2014-05-27 23:59:25,271 [8840] DEBUG Servicemms_warehouse - 获取动态列表
2014-05-27 23:59:25,271 [8840] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2014-05-27 23:59:41,865 [8812] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/log/Index','/Sys/log')
2014-05-27 23:59:43,098 [1276] DEBUG Servicesys_log - 获取实体列表
2014-05-27 23:59:43,099 [1276] DEBUG Sys - select top 20 
        A.*
     from 
        sys_log A
     order by A.ID desc
2014-05-27 23:59:43,105 [1276] DEBUG Sys - select count(*) from ( select 
        A.*
     from 
        sys_log A
     ) tb_temp
2014-05-27 23:59:43,311 [8840] DEBUG Servicesys_loginHistory - 获取实体列表
2014-05-27 23:59:43,312 [8840] DEBUG Sys - select top 20 
        A.*
     from 
        sys_loginHistory A
     order by A.ID desc
2014-05-27 23:59:43,322 [8840] DEBUG Sys - select count(*) from ( select 
        A.*
     from 
        sys_loginHistory A
     ) tb_temp
